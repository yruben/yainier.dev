---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero';
import Stats from '../../components/Stats';
import Skills from '../../components/Skills';
import About from '../../components/About';
import Projects from '../../components/Projects';
import BlogCard from '../../components/BlogCard';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../i18n/utils';
import { languages } from '../../i18n/ui';
import { siteConfig } from '../../config';

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => {
      return { params: { lang } };
  });
}

const { lang } = Astro.params;
const t = useTranslations(lang as any);
const typewriterWords = [
    t('hero.word1'),
    t('hero.word2'),
    t('hero.word3'),
    t('hero.word4'),
    t('hero.word5')
];

const allProjects = await getCollection('projects', ({ id }) => id.startsWith(`${lang}/`));
const sortedProjects = allProjects.sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
const recentProjects = sortedProjects.slice(0, 4);
---

<BaseLayout title={`Yainier - ${lang === 'es' ? 'Desarrollador Web' : 'Web Developer'}`}>
    <Hero client:load trans={{
        hello: t('hero.hello'),
        subtitlePrefix: t('hero.subtitlePrefix'),
        hire: t('hero.hire'),
        contact: t('hero.contact'),
        description: t('hero.description')
    }} titles={typewriterWords} />
    
    <Stats client:visible trans={{
        years: t('stats.years'),
        projects: t('stats.projects'),
        tech: t('stats.tech'),
        clients: t('stats.clients'),
        linkedin: t('stats.linkedin'),
        degree: t('stats.degree')
    }} />

    <Skills client:visible title={t('skills.title')} />

    <About client:visible trans={{
        titlePart1: t('about.title.part1'),
        titlePart2: t('about.title.part2'),
        p1: t('about.p1'),
        p2: t('about.p2'),
        cta: t('about.cta')
    }} lang={lang} />

    <Projects projects={recentProjects} client:visible trans={{
        title: t('projects.title'),
        desc: t('projects.desc'),
        viewAll: t('projects.viewAll'),
        details: t('projects.details')
    }} />
    
    {async () => {
         const allBlogPosts = await getCollection('blog', ({ id }) => id.startsWith(`${lang}/`));
         const sortedPosts = allBlogPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
         const recentPosts = sortedPosts.slice(0, 3);
         const totalArticles = allBlogPosts.length;

         return (
             <section class="py-20 bg-light-bg dark:bg-navy-900 transition-colors duration-300">
                 <div class="container mx-auto px-6">
                     <div class="text-center mb-12">
                         <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">{t('blog.title')}</h2>
                         <p class="text-gray-600 dark:text-gray-300 mb-2">
                             {t('blog.desc')}
                         </p>
                         <p class="text-sm text-light-primary dark:text-neon-cyan font-semibold">
                             {totalArticles} {lang === 'es' ? 'art√≠culos publicados' : 'articles published'}
                         </p>
                         <div class="w-20 h-1 bg-light-primary dark:bg-neon-cyan mx-auto mt-4 rounded-full"></div>
                     </div>

                     <div class="flex flex-wrap justify-center gap-6 mb-12 max-w-7xl mx-auto">
                         {recentPosts.map((post, index) => (
                             <div class="w-full sm:w-72 flex-shrink-0">
                                 <BlogCard client:visible post={post} index={index} lang={lang} />
                             </div>
                         ))}
                     </div>

                     <div class="text-center">
                         <a href={`/${lang}/blog`} class="inline-block px-8 py-3 bg-light-primary dark:bg-neon-cyan text-white dark:text-navy-900 font-bold rounded-full hover:opacity-90 transition-all shadow-md dark:shadow-neon-cyan">
                            {t('blog.readMore')} &rarr;
                         </a>
                     </div>
                 </div>
             </section>
         );
    }}
</BaseLayout>

